<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuoR_code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            /* Nasconde lo scroll */
        }

        /* Animazione per "schizzare" verso l'alto */
        @keyframes shootUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-200px);
                opacity: 0;
            }
        }

        .animate-up {
            animation: shootUp 0.6s ease-out forwards;
        }

        /* Animazione per il cuore che batte */
        @keyframes beat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
            }
        }

        .beating-heart-animation {
            animation: beat 1.2s ease-in-out infinite;
        }

        /* Animazione per "spegnersi" al caricamento */
        @keyframes powerDown {
            0% {
                background-color: #93c5fd;
                /* Blu chiaro "attivo" (blue-300) */
                transform: scale(1.05);
                opacity: 1;
            }

            100% {
                background-color: #d1d5db;
                /* Grigio finale di bg-gray-300 */
                transform: scale(1);
                opacity: 0.8;
                /* Leggermente spento */
            }
        }

        .animate-power-down {
            /* Applica l'animazione di spegnimento */
            animation: powerDown 10s ease-out forwards;
            animation-delay: 0s;
            /* Leggero ritardo per notare l'effetto */
        }

        .progress-dot {
            transition: background-color 0.3s ease;
        }

        .icon-btn {
            position: relative;
        }

        /* Animazione a cerchi concentrici (pulse) */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }

            100% {
                transform: scale(1.6);
                opacity: 0;
            }
        }

        /* Pseudo-elemento per l'animazione */
        .icon-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid #93C5FD;
            animation: pulse 2s ease-out infinite;
        }

        /* Nasconde l'animazione del polso una volta cliccato */
        .icon-btn.clicked::before {
            display: none;
        }


        #image-wrapper img {
            height: 100vh;
            width: 100vw;
            /* Immagine a piena larghezza */
            object-fit: cover;
            flex-shrink: 0;
            /* Impedisce alle immagini di rimpicciolirsi */
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center">

    <!-- Contenitore principale ottimizzato per mobile -->
    <div id="main-content" class="main-container transition-opacity duration-1000">

        <!-- Sezione superiore con titolo -->
        <div class="content-section pt-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-700 mb-12 md:mb-16 text-center leading-tight">
                Riattivare?</h1>
        </div>

        <!-- Sezione centrale con bottoni e indicatori -->
        <div class="content-section flex-1 justify-center">
            <!-- Gruppo di bottoni con spaziatura aumentata -->
            <div class="flex justify-center items-center space-x-8 md:space-x-12 mb-16 md:mb-20">
                <!-- Bottone Segnalibro -->
                <button id="bookmark-btn"
                    class="icon-btn animate-power-down flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-blue-300 text-white rounded-full shadow-lg hover:bg-blue-400 transition-all duration-300">
                    <i class="fas fa-bookmark text-3xl md:text-4xl relative z-10"></i>
                </button>
                <!-- Bottone Commenta -->
                <button id="comment-btn"
                    class="icon-btn animate-power-down flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-blue-300 text-white rounded-full shadow-lg hover:bg-blue-400 transition-all duration-300">
                    <i class="fas fa-comment text-3xl md:text-4xl relative z-10"></i>
                </button>
                <!-- Bottone Condividi -->
                <button id="share-btn"
                    class="icon-btn animate-power-down flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-blue-300 text-white rounded-full shadow-lg hover:bg-blue-400 transition-all duration-300">
                    <i class="fas fa-share-alt text-3xl md:text-4xl relative z-10"></i>
                </button>
            </div>

            <!-- Indicatori di Progresso con spaziatura aumentata -->
            <div id="progress-dots" class="flex justify-center items-center space-x-6 mb-20 md:mb-24 h-8">
                <span class="progress-dot w-4 h-4 md:w-5 md:h-5 bg-gray-300 rounded-full"></span>
                <span class="progress-dot w-4 h-4 md:w-5 md:h-5 bg-gray-300 rounded-full"></span>
                <span class="progress-dot w-4 h-4 md:w-5 md:h-5 bg-gray-300 rounded-full"></span>
            </div>
        </div>

        <!-- MODIFICA: Sezione inferiore con bottone Esci, più in basso e più piccolo -->
        <div class="content-section pt-12 pb-8 flex justify-center">
            <button id="exit-button"
                class="px-16 py-2 md:px-20 md:py-3 text-lg md:text-xl bg-gray-400 text-white font-bold rounded-2xl shadow-xl hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all duration-300 transform hover:scale-105">
                Esci
            </button>
        </div>
    </div>

    <!-- Fullscreen Image Scroller (inizialmente nascosto) -->
    <div id="image-scroller" class="hidden fixed inset-0 bg-black w-full h-full overflow-hidden">
        <div id="image-wrapper" class="w-full flex flex-col">
            <!-- Le immagini verranno iniettate qui da JS -->
        </div>
    </div>

    <!-- Beating Heart Container (inizialmente nascosto) -->
    <div id="heart-container"
        class="hidden fixed inset-0 bg-black w-full h-full flex items-center justify-center opacity-0 transition-opacity duration-1000">
        <svg id="beating-heart-svg"
            class="w-40 h-40 md:w-52 md:h-52 text-blue-500 beating-heart-animation opacity-0 transition-opacity duration-1000"
            viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
        </svg>
    </div>


    <script>
        // --- ELEMENTI GLOBALI ---
        const mainContent = document.getElementById('main-content');
        const progressDots = document.querySelectorAll('.progress-dot');

        let audioInitialized = false;
        let synth = null;

        async function initializeAudio() {
            if (audioInitialized) return;

            try {
                await Tone.start();
                synth = new Tone.Synth().toDestination();
                audioInitialized = true;
                console.log('Audio inizializzato correttamente');
            } catch (error) {
                console.warn('Errore nell\'inizializzazione audio:', error);
            }
        }
        function playSound() {
            if (!audioInitialized || !synth) {
                console.warn('Audio non inizializzato');
                return;
            }

            try {
                synth.triggerAttackRelease("C5", "8n");
            } catch (error) {
                console.warn('Errore nella riproduzione audio:', error);
            }
        }

        // --- MODIFICA: LOGICA ICONE SUPERIORI AGGIORNATA ---
        const iconButtons = [
            document.getElementById('bookmark-btn'),
            document.getElementById('comment-btn'),
            document.getElementById('share-btn')
        ];
        const heartContainer = document.getElementById('heart-container');
        const clickedButtons = new Set(); // Usa un Set per memorizzare gli ID dei bottoni cliccati

        const handleIconClick = async (e) => {
            const button = e.currentTarget;

            // Se l'animazione finale è già partita, non fare nulla
            if (iconButtons[0].classList.contains('animate-up')) return;

            // Se questo specifico bottone è già stato cliccato, non fare nulla
            if (clickedButtons.has(button.id)) return;

            // Inizializza l'audio alla prima interazione
            if (!audioInitialized) {
                await initializeAudio();
            }
            playSound();

            // 1. "Riaccendi" il bottone al suo colore blu iniziale
            button.classList.add('clicked'); // Ferma l'animazione a polso
            button.classList.remove('animate-power-down'); // Rimuove lo stato di animazione "spenta"
            
            // Imposta esplicitamente il colore di sfondo blu, sovrascrivendo il grigio
            // lasciato dall'animazione 'powerDown' che ha 'forwards' come fill mode.
            button.style.backgroundColor = '#3b82f6'; // Corrisponde a Tailwind blue-500

            // Aggiorna il pallino di progresso corrispondente
            const buttonIndex = iconButtons.indexOf(button);
            if (buttonIndex !== -1) {
                progressDots[buttonIndex].classList.remove('bg-gray-300');
                progressDots[buttonIndex].classList.add('bg-blue-500');
            }

            // Aggiungi il bottone al set di quelli cliccati
            clickedButtons.add(button.id);

            // 2. Controlla se tutti e tre i bottoni sono stati cliccati
            if (clickedButtons.size === 3) {
                // Se sì, avvia l'animazione "shootUp" per tutti i bottoni
                iconButtons.forEach(btn => {
                    btn.classList.add('animate-up');
                });

                // Mostra il cuore pulsante dopo un breve ritardo
                setTimeout(showBeatingHeart, 800);
            }
        };


        function playHeartSound() {
            if (!audioInitialized || !synth) return;

            try {
                // Sequenza allegra tipo "vittoria/jackpot"
                synth.triggerAttackRelease("C5", "8n");
                setTimeout(() => synth.triggerAttackRelease("E5", "8n"), 150);
                setTimeout(() => synth.triggerAttackRelease("G5", "8n"), 300);
                setTimeout(() => synth.triggerAttackRelease("C6", "4n"), 500);
            } catch (error) {
                console.warn('Errore nella riproduzione audio del cuore:', error);
            }
        }

        function showBeatingHeart() {
            const heartSvg = document.getElementById('beating-heart-svg');

            // 1. Avvia il fade-out del contenuto principale
            mainContent.classList.add('opacity-0', 'pointer-events-none');

            // Attendi la fine del fade-out del contenuto principale
            setTimeout(() => {
                mainContent.classList.add('hidden');

                // 2. Mostra il contenitore nero (heart-container) e avvia il suo fade-in
                heartContainer.classList.remove('hidden');
                requestAnimationFrame(() => {
                    heartContainer.classList.remove('opacity-0');
                });

                // 3. Attendi un momento sulla schermata nera, poi fai apparire il cuore
                setTimeout(() => {
                    heartSvg.classList.remove('opacity-0');
                    playHeartSound(); // 🔊 Riproduci suono al momento in cui appare il cuore
                }, 500);

            }, 1000);
        }

        iconButtons.forEach(button => button.addEventListener('click', handleIconClick));

        // --- LOGICA BOTTONE "ESCI" E SCROLLER IMMAGINI ---
        const exitButton = document.getElementById('exit-button');
        const imageScroller = document.getElementById('image-scroller');
        const imageWrapper = document.getElementById('image-wrapper');

        const imageUrls = [
            'images/image_1.png',
            'images/image_2.png',
            'images/image_3.png',
            'images/image_1.png',
            'images/image_2.png',
            'images/image_3.png',
            'images/image_1.png',
            'images/image_2.png',
            'images/image_3.png',
            'images/image_1.png',
            'images/image_2.png',
            'images/image_3.png',
            'images/image_1.png',
            'images/image_2.png',
            'images/image_3.png',
        ];

        let currentIndex = 0;
        let loopCount = 0;
        const maxLoops = 1; // numero massimo di giri
        const displayTime = 1000; // quanto tempo resta un'immagine ferma (ms)
        const transitionTime = 500; // durata dell'animazione di scorrimento (ms)

        function startImageScroller() {
            mainContent.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                mainContent.classList.add('hidden');
                imageScroller.classList.remove('hidden');
            }, 1000);

            imageWrapper.innerHTML = '';
            imageUrls.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                imageWrapper.appendChild(img);
            });

            // Applica stile per animazioni fluide tipo TikTok
            imageWrapper.style.transition = `transform ${transitionTime}ms ease-in-out`;

            showNextImage();
        }

        function showNextImage() {
            if (loopCount >= maxLoops) {

                return; // fermati dopo 1 giro
            }

            currentIndex++;

            // Se arrivo alla fine, resetto e conto un giro
            if (currentIndex >= imageUrls.length) {
                currentIndex = 0;
                loopCount++;
                if (loopCount >= maxLoops) {
                    console.log("Fine carosello");
                    return;
                }
            }

            const offset = -(currentIndex * window.innerHeight);
            imageWrapper.style.transform = `translateY(${offset}px)`;

            // Aspetta che l'immagine stia ferma un po’, poi passa alla prossima
            setTimeout(showNextImage, displayTime + transitionTime);
        }

        exitButton.addEventListener('click', startImageScroller);
    </script>

</body>

</html>

